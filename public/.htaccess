# Next.js Static Export Apache Configuration (Trailing Slash Optimized)
Options -Indexes -MultiViews
RewriteEngine On
RewriteBase /

# ============================================
# SECURITY HEADERS
# ============================================

# Prevent clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# Prevent MIME type sniffing
Header always set X-Content-Type-Options "nosniff"

# XSS Protection
Header always set X-XSS-Protection "1; mode=block"

# Referrer Policy
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Content Security Policy
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://api-maps.yandex.ru https://api.telegram.org; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; connect-src 'self' https://*.supabase.co https://api.telegram.org; font-src 'self' data:; frame-src 'self';"

# Permissions Policy
Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(self)"

# DNS Prefetch Control
Header always set X-DNS-Prefetch-Control "on"

# HSTS (HTTPS Strict Transport Security)
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

# ============================================
# ROUTING
# ============================================

# 1. Redirect /index.html to /
RewriteRule ^index\.html$ / [R=301,L]

# 2. Match URLs without trailing slash and add it
# This ensures that /category becomes /category/ which maps to /category/index.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !(.*)/$
RewriteCond %{REQUEST_URI} !(\.[a-zA-Z0-9]{1,5})$
RewriteRule ^(.*)$ $1/ [L,R=301]

# 3. If the request is for a path (with slash), Apache will naturally find index.html
# No extra rewrites needed for extensionless URLs when trailingSlash is true!

# 4. Handle 404
# (Next.js with trailingSlash: true creates 404/index.html)
ErrorDocument 404 /404/index.html
